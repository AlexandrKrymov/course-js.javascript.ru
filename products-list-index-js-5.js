(window.webpackJsonp=window.webpackJsonp||[]).push([[5],{10:function(e,t,s){"use strict";function n(e,t,s){return t in e?Object.defineProperty(e,t,{value:s,enumerable:!0,configurable:!0,writable:!0}):e[t]=s,e}s.d(t,"a",(function(){return i}));class i{constructor(e,{data:t=[],url:s="",sorted:i={id:e.find(e=>e.sortable).id,order:"asc"},isSortLocally:r=!1,rowTemplate:a=(e=>`<div class="sortable-table__row">${e}</div>`)}={}){n(this,"element",void 0),n(this,"hasDataLoad",!0),n(this,"onClick",async e=>{const t=e.target.closest('[data-sortable="true"]');if(!t)return;const s=this.toggleOrder(t.dataset.order);t.dataset.order=s,t.append(this.subElements.arrow),await this.sort(t.dataset.id,s),this.sorted.id=t.dataset.id,this.sorted.order=s}),n(this,"onScroll",()=>{if(!this.hasDataLoad)return;const e=this.element.scrollHeight+this.element.offsetTop;document.documentElement.clientHeight+window.pageYOffset>=e-100&&!this.isLoading&&this.loadMore()}),n(this,"isLoading",!1),n(this,"start",0),n(this,"end",30),n(this,"step",30),n(this,"offset",this.end),n(this,"sortFunctions",{string:(e,t,s="asc")=>e.sort((e,n)=>{let i=e[t].localeCompare(n[t],["ru-RU","es-US"],{localeMatcher:"lookup",caseFirst:"upper"});return"desc"===s&&(i*=-1),i}),number:(e,t,s="asc")=>e.sort((e,n)=>{let i=e[t]-n[t];return"desc"===s&&(i*=-1),i}),date:(e,t,s="asc")=>e.sort((e,n)=>{let i=new Date(n[t])-new Date(e[t]);return"desc"===s&&(i*=-1),i})}),this.headersConfig=e,this.data=t,this.url=new URL(s),this.rowTemplate=a,this.sorted=i,this.isSortLocally=r,this.render()}async render(){const e=this.toHTML(this.getTemplate());this.element?this.element.innerHtml=e.innerHtml:this.element=e,this.subElements=this.getSubElements(this.element),this.addEventListeners(),await this.sort(this.sorted.id,this.sorted.order)}getTemplate(){return`\n      <div class="sortable-table">\n        ${this.getHeader()}\n        ${this.getBody()}\n        <div data-element="loading" class="loading-line sortable-table__loading-line"></div>\n        <div data-element="emptyPlaceholder" class="sortable-table__empty-placeholder">\n          <div>\n            <p>No products satisfies your filter criteria</p>\n            <button type="button" class="button-primary-outline" data-element="resetFilterBtn">Reset all filters</button>\n          </div>\n        </div>\n      </div>\n    `}getHeader(){return`\n      <div data-element="header" class="sortable-table__header sortable-table__row">${this.headersConfig.map(e=>this.getHeaderCell(e)).join("")}</div>\n    `}getHeaderCell({id:e="",title:t="",sortable:s=!1}={}){const n=this.sorted.id===e?this.getArrow():"";return`\n      <div class="sortable-table__cell" id="${e}" data-id="${e}" data-sortable="${s}" data-order="${this.sorted.order}">\n        <span>${t}</span>\n        ${n}\n      </div>\n    `}getDefaultCellTemplate(e){return`\n      <div class="sortable-table__cell">${e}</div>\n    `}getBody(){return`<div data-element="body" class="sortable-table__body">${this.getRows().join("")}</div>`}getRows(e=[]){return e.map(e=>{const t=this.headersConfig.map(t=>{const s=e[t.id];return t.template?t.template(s):this.getDefaultCellTemplate(s)});return this.getRow(t.join(""),e)})}getRow(e,t){return this.rowTemplate(e,t)}async sort(e=this.sorted.id,t=this.sorted.order){let s=this.isSortLocally?this.sortOnClient(e,t):await this.sortOnServer(e,t);this.subElements&&this.subElements.body&&(this.element.classList.remove("sortable-table_empty"),this.subElements.body.innerHTML=this.getRows(s).join("")),s.length||this.element.classList.add("sortable-table_empty")}sortOnClient(e,t){let s="";if(this.headersConfig.forEach(n=>{n.id===e?(n.order=t,s=n.sortType):n.order=!1}),s)return this.sortFunctions[s](this.data,e,t)}async sortOnServer(e,t){return await this.loadData(e,t)}async loadData(e,t,s=this.start,n=this.end){this.addLoader(),this.url.searchParams.set("_sort",e),this.url.searchParams.set("_order",t),this.url.searchParams.set("_start",s),this.url.searchParams.set("_end",n);try{const e=await fetch(this.url.toString()),t=await e.json();return this.removeLoader(),t}catch(e){console.error("Loading data error in sortable table",e)}}getArrow(){return'\n      <span data-element="arrow" class="sortable-table__sort-arrow">\n        <span class="sort-arrow"></span>\n      </span>\n    '}toHTML(e){const t=document.createElement("div");return t.innerHTML=e,t.firstElementChild}toggleOrder(e){return{asc:"desc",desc:"asc"}[e]||"desc"}getSubElements(e){const t={};return[...e.querySelectorAll("[data-element]")].forEach(e=>{t[e.dataset.element]=e}),t}addEventListeners(){this.subElements.header.addEventListener("pointerdown",this.onClick),document.addEventListener("scroll",this.onScroll)}removeEventListeners(){this.subElements.header.removeEventListener("pointerdown",this.onClick),document.removeEventListener("scroll",this.onScroll)}async loadMore(){const e=this.offset,t=this.offset+this.step,s=await this.loadData(this.sorted.id,this.sorted.order,e,t);if(s.length){const e=document.createElement("div");e.innerHTML=this.getRows(s),this.subElements.body.append(...e.children),this.offset=t}else this.hasDataLoad=!1}addLoader(){this.isLoading=!0,this.element.classList.add("sortable-table_loading")}removeLoader(){this.isLoading=!1,this.element.classList.remove("sortable-table_loading")}remove(){this.element&&this.element.remove(),this.element=null}destroy(){this.remove(),this.removeEventListeners()}}},7:function(e,t,s){"use strict";s.r(t),s.d(t,"default",(function(){return o}));var n=s(10);function i(e,t,s){return t in e?Object.defineProperty(e,t,{value:s,enumerable:!0,configurable:!0,writable:!0}):e[t]=s,e}class r{constructor({min:e=100,max:t=200,formatValue:s=(e=>"$"+e),selected:n={from:e,to:t}}={}){i(this,"element",void 0),i(this,"subElements",{}),i(this,"onThumbPointerMove",e=>{e.preventDefault();const{left:t,right:s,width:n}=this.subElements.inner.getBoundingClientRect();if(this.dragging===this.subElements.thumbLeft){let s=(e.clientX-t+this.shiftX)/n;s<0&&(s=0),s*=100;const i=parseFloat(this.subElements.thumbRight.style.right);s+i>100&&(s=100-i),this.dragging.style.left=this.subElements.progress.style.left=s+"%",this.subElements.from.innerHTML=this.formatValue(this.getValue().from)}if(this.dragging===this.subElements.thumbRight){let t=(s-e.clientX-this.shiftX)/n;t<0&&(t=0),t*=100;const i=parseFloat(this.subElements.thumbLeft.style.left);i+t>100&&(t=100-i),this.dragging.style.right=this.subElements.progress.style.right=t+"%",this.subElements.to.innerHTML=this.formatValue(this.getValue().to)}}),i(this,"onThumbPointerUp",()=>{this.element.classList.remove("range-slider_dragging"),document.removeEventListener("pointermove",this.onThumbPointerMove),document.removeEventListener("pointerup",this.onThumbPointerUp),this.element.dispatchEvent(new CustomEvent("range-select",{detail:this.getValue(),bubbles:!0}))}),this.min=e,this.max=t,this.formatValue=s,this.selected=n,this.render()}get template(){const{from:e,to:t}=this.selected;return`<div class="range-slider">\n        <span data-element="from">${this.formatValue(e)}</span>\n        <div data-element="inner" class="range-slider__inner">\n          <span data-element="progress" class="range-slider__progress"></span>\n          <span data-element="thumbLeft" class="range-slider__thumb-left"></span>\n          <span data-element="thumbRight" class="range-slider__thumb-right"></span>\n        </div>\n        <span data-element="to">${this.formatValue(t)}</span>\n      </div>`}render(){const e=document.createElement("div");e.innerHTML=this.template,this.element=e.firstElementChild,this.element.ondragstart=()=>!1,this.subElements=this.getSubElements(e),this.initEventListeners(),this.update()}initEventListeners(){const{thumbLeft:e,thumbRight:t}=this.subElements;e.addEventListener("pointerdown",e=>this.onThumbPointerDown(e)),t.addEventListener("pointerdown",e=>this.onThumbPointerDown(e))}getSubElements(e){const t={},s=e.querySelectorAll("[data-element]");for(const e of s){t[e.dataset.element]=e}return t}remove(){this.element&&this.element.remove(),this.element.remove()}destroy(){this.remove(),document.removeEventListener("pointermove",this.onThumbPointerMove),document.removeEventListener("pointerup",this.onThumbPointerUp)}update(){const e=this.max-this.min,t=Math.floor((this.selected.from-this.min)/e*100)+"%",s=Math.floor((this.max-this.selected.to)/e*100)+"%";this.subElements.progress.style.left=t,this.subElements.progress.style.right=s,this.subElements.thumbLeft.style.left=t,this.subElements.thumbRight.style.right=s}onThumbPointerDown(e){const t=e.target;e.preventDefault();const{left:s,right:n}=t.getBoundingClientRect();t===this.subElements.thumbLeft?this.shiftX=n-e.clientX:this.shiftX=s-e.clientX,this.dragging=t,this.element.classList.add("range-slider_dragging"),document.addEventListener("pointermove",this.onThumbPointerMove),document.addEventListener("pointerup",this.onThumbPointerUp)}getValue(){const e=this.max-this.min,{left:t}=this.subElements.thumbLeft.style,{right:s}=this.subElements.thumbRight.style;return{from:Math.round(this.min+.01*parseFloat(t)*e),to:Math.round(this.max-.01*parseFloat(s)*e)}}}var a=[{id:"images",title:"Image",sortable:!1,template:e=>e.length?`\n        <div class="sortable-table__cell">\n          <img class="sortable-table-image" alt="Image" src="${e[0].url}">\n        </div>\n      `:'\n        <div class="sortable-table__cell">\n          <img class="sortable-table-image" alt="Image" src="https://via.placeholder.com/100">\n        </div>\n      '},{id:"title",title:"Name",sortable:!0,sortType:"string"},{id:"subcategory",title:"Category",sortable:!1,template:e=>`<div class="sortable-table__cell">\n          ${e.title}\n        </div>`},{id:"quantity",title:"Quantity",sortable:!0,sortType:"number"},{id:"price",title:"Price",sortable:!0,sortType:"number"},{id:"status",title:"Status",sortable:!0,sortType:"number",template:e=>`<div class="sortable-table__cell">\n          ${e>0?"Active":"Inactive"}\n        </div>`}];function l(e,t,s){return t in e?Object.defineProperty(e,t,{value:s,enumerable:!0,configurable:!0,writable:!0}):e[t]=s,e}class o{constructor(){l(this,"components",{}),l(this,"priceMin",0),l(this,"priceMax",5e3),l(this,"priceFrom",this.priceMin),l(this,"priceTo",this.priceMax),l(this,"status",void 0),l(this,"titleLike",void 0),l(this,"timer",void 0),l(this,"onChangeRange",e=>{this.priceFrom=e.detail.from,this.priceTo=e.detail.to,this.updateSortableTable()}),l(this,"onChangeStatus",e=>{const t=Number(e.target.value);this.status=t>=0?t:null,this.updateSortableTable()}),l(this,"onInputTitle",e=>{clearTimeout(this.timer),this.timer=setTimeout(()=>{this.titleLike=e.target.value,this.updateSortableTable()},1e3)}),l(this,"onFilterReset",e=>{e.target.closest('[data-element="resetFilterBtn"]')&&(this.subElements.filterStatus.value=-1,this.status=null,this.subElements.filterName.value="",this.titleLike="",this.updateRangeSlider(),this.priceFrom=this.priceMin,this.priceTo=this.priceMax,this.updateSortableTable())})}render(){return this.initComponents(),this.element=this.toHTML(this.getTemplate()),this.renderComponents(),this.subElements=this.getSubElements(this.element),this.addEventListeners(),this.element}getTemplate(){return'\n    <div class="products-list">\n      <div class="content__top-panel">\n        <h1 class="page-title">Товары</h1>\n        <a href="/products/add" class="button-primary">Добавить товар</a>\n      </div>\n      <div class="content-box content-box_small">\n        <form class="form-inline">\n          <div class="form-group">\n            <label class="form-label">Сортировать по:</label>\n            <input\n              type="text"\n              data-element="filterName"\n              class="form-control"\n              placeholder="Название товара"\n            />\n          </div>\n          <div class="form-group" data-elem="sliderContainer">\n            <label class="form-label">Цена:</label>\n            <div data-rangeSlider>\n            </div>\n          </div>\n          <div class="form-group">\n            <label class="form-label">Статус:</label>\n            <select class="form-control" data-element="filterStatus">\n              <option value="-1" selected="">Любой</option>\n              <option value="1">Активный</option>\n              <option value="0">Неактивный</option>\n            </select>\n          </div>\n        </form>\n      </div>\n      <div data-elem="productsContainer" class="products-list__container">\n        <div data-sortableTable>\n        </div>\n      </div>\n    </div>\n    '}initComponents(){const e=this.initRangeSlider(),t=this.initSortableTable();this.components={rangeSlider:e,sortableTable:t}}initSortableTable(e=this.priceFrom,t=this.priceTo,s=this.status,i=this.titleLike){const r=new URL("api/rest/products","https://course-js.javascript.ru/");r.searchParams.set("_embed","subcategory.category"),e&&r.searchParams.set("price_gte",e),t&&r.searchParams.set("price_lte",t),(s||0===s)&&r.searchParams.set("status",s),i&&r.searchParams.set("title_like",i);const l=new n.a(a,{url:r.toString(),rowTemplate:(e,t)=>`<a href="/products/${t.id}" class="sortable-table__row">${e}</a>`,sorted:{id:"title",order:"asc"}});return l.element.dataset.element="sortableTable",l}initRangeSlider(){const e=new r({min:this.priceMin,max:this.priceMax});return e.element.dataset.element="rangeSlider",e}renderComponents(){for(const e of Object.entries(this.components))this.element.querySelector(`[data-${e[0]}]`).replaceWith(e[1].element)}updateSortableTable(){const e=this.initSortableTable();this.subElements.sortableTable.replaceWith(e.element),this.subElements.sortableTable=e.element,this.components.sortableTable.destroy(),this.components.sortableTable=e}updateRangeSlider(){const e=this.initRangeSlider();this.subElements.rangeSlider.replaceWith(e.element),this.subElements.rangeSlider=e.element,this.components.rangeSlider.destroy(),this.components.rangeSlider=e}getSubElements(e){const t={};return[...e.querySelectorAll("[data-element]")].forEach(e=>{t[e.dataset.element]=e}),t}addEventListeners(){document.addEventListener("range-select",this.onChangeRange),this.subElements.filterStatus.addEventListener("change",this.onChangeStatus),this.subElements.filterName.addEventListener("input",this.onInputTitle),document.addEventListener("pointerup",this.onFilterReset)}removeEventListeners(){document.removeEventListener("range-select",this.onChangeRange),document.removeEventListener("pointerup",this.onFilterReset)}remove(){this.element&&this.element.remove(),this.element=null}destroy(){this.remove(),this.removeEventListeners();for(const e of Object.values(this.components))e.destroy()}toHTML(e){const t=document.createElement("div");return t.innerHTML=e,t.firstElementChild}}}}]);
//# sourceMappingURL=products-list-index-js-5.js.map