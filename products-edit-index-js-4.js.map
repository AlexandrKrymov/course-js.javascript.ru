{"version":3,"sources":["webpack:///./src/components/sortable-list/index.js","webpack:///./src/components/notification/index.js","webpack:///./src/utils/escape-html.js","webpack:///./src/components/product-form/index.js","webpack:///./src/pages/products/edit/index.js"],"names":["SortableList","constructor","items","event","item","target","closest","preventDefault","handleGrab","handleDelete","this","dragstart","remove","dragend","setStyles","dragged","left","x","shiftX","top","y","shiftY","style","visibility","elementBellow","document","elementFromPoint","droppable","currentDroppable","coordY","getBoundingClientRect","moveDirection","getMoveDirection","pageY","element","nextSibling","insertPlaceholder","elements","render","addEventListeners","list","createElement","classList","add","map","getListItem","append","placeholder","getPlaceholder","elem","toHTML","addEventListener","onPointerDown","removeEventListeners","removeEventListener","props","prop","onPointerUp","draggedRect","clientX","clientY","draggedHeight","clientHeight","draggedWidth","clientWidth","width","height","onPointerMove","insertBefore","dispatchEvent","CustomEvent","oldY","newY","htmlString","htmlObject","innerHTML","firstElementChild","destroy","NotificationMessage","message","duration","type","setTimer","setTimeout","wrapper","template","show","body","currentNotification","clearTimeout","timer","string","replace","ProductForm","productId","save","imageInput","accept","hidden","uploadImage","subElements","imageListContainer","click","async","file","files","data","FormData","set","productForm","disabled","response","fetch","method","headers","Authorization","image","json","images","push","source","name","url","link","renderImagesList","error","console","productsUrl","URL","process","categoriesUrl","requests","loadCategories","loadProductData","categories","productData","Promise","all","replaceWith","getTemplate","getSubElements","imagesList","getImagesList","searchParams","toString","formData","getFormData","eventName","product","detail","form","title","get","description","subcategory","price","parseInt","discount","quantity","status","getImagesData","id","JSON","stringify","sources","getAll","urls","index","escapeHtml","getCategoriesSelectTemplate","currentSubcategory","category","subcategories","isSelected","join","createSortableList","root","querySelectorAll","forEach","el","dataset","onSubmit","imageUploadBtn","addImage","router","Router","instance","Page","getProductId","notyShow","navigate","herfArray","window","location","href","split","length","initComponents","renderComponents","components","component","Object","entries","querySelector","timeout","onProductUpdate","onProductSave","values"],"mappings":"mPAAe,MAAMA,EA6DnBC,aAAY,MAACC,GAAS,IAAI,uBA5DTC,IACf,MAAMC,EAAOD,EAAME,OAAOC,QAAQ,wBAClC,IAAKF,EAAM,OACXD,EAAMI,iBACN,MAAMC,EAAaL,EAAME,OAAOC,QAAQ,sBAClCG,EAAeN,EAAME,OAAOC,QAAQ,wBAEtCE,EACFE,KAAKC,UAAUP,EAAMD,GACZM,GACTL,EAAKQ,WAkDiB,qBA9CXT,IACbA,EAAMI,iBACNG,KAAKG,YA4CmB,uBAzCTV,IACfA,EAAMI,iBACNG,KAAKI,UAAUJ,KAAKK,QAAS,CAC3BC,KAASb,EAAMc,EAAIP,KAAKQ,OAAjB,KACPC,IAAQhB,EAAMiB,EAAIV,KAAKW,OAAjB,OAGRX,KAAKK,QAAQO,MAAMC,WAAa,SAChC,MAAMC,EAAgBC,SAASC,iBAAiBvB,EAAMc,EAAGd,EAAMiB,GAI/D,GAHAV,KAAKK,QAAQO,MAAMC,WAAa,IAG3BC,EAEH,YADAd,KAAKG,UAKP,MAAMc,EAAYH,EAAclB,QAAQ,wBAGxC,IAAKqB,GAAaA,IAAcjB,KAAKkB,iBAEnC,YADAlB,KAAKkB,iBAAmB,MAI1B,MAAMC,EAASF,EAAUG,wBAAwBX,IAG3CY,EAAgBrB,KAAKsB,iBAAiBtB,KAAKuB,MAAO9B,EAAM8B,OAI9D,GAHAvB,KAAKuB,MAAQ9B,EAAM8B,MAGf9B,EAAM8B,MAAQJ,EAAQ,CACxB,MAAMK,EAA6B,SAAlBH,EAA4BJ,EAAUQ,YAAcR,EACrEjB,KAAK0B,kBAAkBF,GAGzBxB,KAAKkB,iBAAmBD,IAIxBjB,KAAK2B,SAAWnC,EAChBQ,KAAK4B,SACL5B,KAAK6B,oBAGPD,SACE,MAAME,EAAOf,SAASgB,cAAc,MACpCD,EAAKE,UAAUC,IAAI,iBACnB,MAAMN,EAAW3B,KAAK2B,SAASO,IAAKV,GAAYxB,KAAKmC,YAAYX,IACjEM,EAAKM,UAAUT,GACf3B,KAAKqC,YAAcrC,KAAKsC,iBACxBtC,KAAKwB,QAAUM,EAGjBK,YAAYI,GACV,MAAMf,EAA0B,iBAATe,EAAoBA,EAAOvC,KAAKwC,OAAOD,GAE9D,OADAf,EAAQQ,UAAUC,IAAI,uBACfT,EAGTc,iBACE,MAAMD,EAActB,SAASgB,cAAc,OAE3C,OADAM,EAAYL,UAAUC,IAAI,8BACnBI,EAGTR,oBACE7B,KAAKwB,QAAQiB,iBAAiB,cAAezC,KAAK0C,eAGpDC,uBACE3C,KAAKwB,QAAQoB,oBAAoB,cAAe5C,KAAK0C,eAGvDtC,UAAUoB,EAASqB,GACjB,IAAK,MAAMC,KAAQD,EACjBrB,EAAQZ,MAAMkC,GAAQD,EAAMC,GAIhC7C,UAAUI,EAASZ,GACjBO,KAAKK,QAAUA,EACfL,KAAKwB,QAAQiB,iBAAiB,YAAazC,KAAK+C,aAEhD,MAAMC,EAAchD,KAAKK,QAAQe,wBACjCpB,KAAKQ,OAASf,EAAMwD,QAAUD,EAAY1C,KAC1CN,KAAKW,OAASlB,EAAMyD,QAAUF,EAAYvC,IAE1CT,KAAKmD,cAAgBnD,KAAKK,QAAQ+C,aAClCpD,KAAKqD,aAAerD,KAAKK,QAAQiD,YAEjCtD,KAAKI,UAAUJ,KAAKK,QAAS,CAC3BkD,MAAUvD,KAAKqD,aAAP,KACR/C,KAASb,EAAMc,EAAIP,KAAKQ,OAAjB,KACPC,IAAQhB,EAAMiB,EAAIV,KAAKW,OAAjB,OAERX,KAAKI,UAAUJ,KAAKqC,YAAa,CAC/BmB,OAAWxD,KAAKmD,cAAP,OAGXnD,KAAK0B,kBAAkB1B,KAAKK,SAC5BL,KAAKK,QAAQ2B,UAAUC,IAAI,gCAE3BjC,KAAKwB,QAAQiB,iBAAiB,cAAezC,KAAKyD,eAGpDtD,UACEH,KAAKwB,QAAQkC,aAAa1D,KAAKK,QAASL,KAAKqC,aAC7CrC,KAAKqC,YAAYnC,SACjBF,KAAKI,UAAUJ,KAAKK,QAAS,CAC3BkD,MAAO,GACPjD,KAAM,GACNG,IAAK,KAGPT,KAAKK,QAAQ2B,UAAU9B,OAAO,gCAC9BF,KAAKK,QAAU,KAEfL,KAAKwB,QAAQoB,oBAAoB,cAAe5C,KAAKyD,eACrDzD,KAAKwB,QAAQoB,oBAAoB,YAAa5C,KAAK+C,aACnD/C,KAAKwB,QAAQmC,cAAc,IAAIC,YAAY,YAG7CtC,iBAAiBuC,EAAMC,GACrB,OAAID,EAAOC,EACF,OACED,EAAOC,EACT,UADF,EAKTpC,kBAAkBF,GAChBxB,KAAKwB,QAAQkC,aAAa1D,KAAKqC,YAAab,GAG9CgB,OAAOuB,GACL,MAAMC,EAAajD,SAASgB,cAAc,OAE1C,OADAiC,EAAWC,UAAYF,EAChBC,EAAWE,kBAGpBhE,SACMF,KAAKwB,SAASxB,KAAKwB,QAAQtB,SAC/BF,KAAKwB,QAAU,KACfxB,KAAK2C,uBAGPwB,UACEnE,KAAKE,Y,gCC1KT,kCAAe,MAAMkE,EACnB7E,YAAY8E,EAAU,IAAI,SAACC,EAAW,IAAZ,KAAkBC,EAAO,WAAa,IAC9DvE,KAAKqE,QAAUA,EACfrE,KAAKsE,SAAWA,EAChBtE,KAAKuE,KAAOA,EAEZvE,KAAK4B,SAGP,eACE,MAAQ,iDACkC5B,KAAKuE,4DACLvE,KAAKqE,oCAKjDG,WACEC,WAAW,KACTzE,KAAKmE,WACJnE,KAAKsE,UAGV1C,SACE,MAAM8C,EAAU3D,SAASgB,cAAc,OACvC2C,EAAQT,UAAYjE,KAAK2E,SACzB3E,KAAKwB,QAAUkD,EAAQR,kBAGzBU,KAAKjF,EAASoB,SAAS8D,MACjBT,EAAoBU,qBAAqBV,EAAoBU,oBAAoBX,UACrFxE,EAAOyC,OAAOpC,KAAKwB,SACnBuD,aAAaX,EAAoBY,OACjCZ,EAAoBY,MAAQhF,KAAKwE,WACjCJ,EAAoBU,oBAAsB9E,KAG5CE,SACMF,KAAKwB,SAASxB,KAAKwB,QAAQtB,SAC/BF,KAAKwB,QAAU,KAGjB2C,UACEnE,KAAKE,SACLkE,EAAoBU,oBAAsB,Q,0FC5C/BG,KAAUA,EACtBC,QAAQ,KAAM,SACdA,QAAQ,KAAM,UACdA,QAAQ,KAAM,SACdA,QAAQ,KAAM,QACdA,QAAQ,KAAM,Q,wHCFF,MAAMC,EAkDnB5F,YAAY6F,GAAW,kBAjDZ3F,IACTA,EAAMI,iBACNG,KAAKqF,SA+CgB,kBA5CZ5F,IACTA,EAAMI,iBAEN,MAAMyF,EAAavE,SAASgB,cAAc,SAC1CuD,EAAWf,KAAO,OAClBe,EAAWC,OAAS,UACpBD,EAAWE,QAAS,EACpBF,EAAW7C,iBAAiB,SAAUzC,KAAKyF,aAE3CzF,KAAK0F,YAAYC,mBAAmBvD,OAAOkD,GAC3CA,EAAWM,UAkCU,qBA/BTC,UACZ,MACMC,EADQrG,EAAME,OACDoG,MAAM,GACnBC,EAAO,IAAIC,SACjBD,EAAKE,IAAI,QAASJ,GAElB9F,KAAK0F,YAAYS,YAAYV,YAAYzD,UAAUC,IAAI,cACvDjC,KAAK0F,YAAYS,YAAYV,YAAYW,UAAW,EAEpD,IACE,MAAMC,QAAiBC,MAAM,gCAAiC,CAC5DC,OAAQ,OACRC,QAAS,CACPC,cAAgB,6BAElB5B,KAAMmB,IAEFU,QAAcL,EAASM,OAC7B3G,KAAK4G,OAAOC,KAAK,CACfC,OAAQJ,EAAMV,KAAKe,KACnBC,IAAKN,EAAMV,KAAKiB,OAElBjH,KAAKkH,mBACL,MAAOC,GACPC,QAAQD,MAAMA,GAfhB,QAiBEnH,KAAK0F,YAAYS,YAAYV,YAAYzD,UAAU9B,OAAO,cAC1DF,KAAK0F,YAAYS,YAAYV,YAAYW,UAAW,KAKtDpG,KAAKoF,UAAYA,EACjBpF,KAAK4G,OAAS,GACd5G,KAAKqH,YAAc,IAAIC,IAAI,sBAAuBC,oCAClDvH,KAAKwH,cAAgB,IAAIF,IAAI,wBAAyBC,oCAGxD,eACE,MAAME,EAAW,CAACzH,KAAK0H,kBACnB1H,KAAKoF,WAAWqC,EAASZ,KAAK7G,KAAK2H,mBAEvC,MAAOC,EAAYC,EAAc,UAAYC,QAAQC,IAAIN,GAazD,OAXII,EAAYjB,SAAQ5G,KAAK4G,OAASiB,EAAYjB,QAE9C5G,KAAKwB,QACPxB,KAAKwB,QAAQwG,YAAYhI,KAAKwC,OAAOxC,KAAKiI,YAAYJ,EAAaD,KAChE5H,KAAKwB,QAAUxB,KAAKwC,OAAOxC,KAAKiI,YAAYJ,EAAaD,IAE9D5H,KAAK0F,YAAc1F,KAAKkI,eAAelI,KAAKwB,SAE5CxB,KAAKkH,mBACLlH,KAAK6B,oBAEE7B,KAAKwB,QAGd0F,mBACE,MAAMiB,EAAanI,KAAKoI,cAAcpI,KAAK4G,QACvC5G,KAAKmI,WACPnI,KAAKmI,WAAWH,YAAYG,GAE5BnI,KAAK0F,YAAYC,mBAAmBvD,OAAO+F,GAE7CnI,KAAKmI,WAAaA,EAGpB,wBACEnI,KAAKqH,YAAYgB,aAAanC,IAAI,KAAMlG,KAAKoF,WAE7C,MAAMiB,QAAiBC,MAAMtG,KAAKqH,YAAYiB,YACxC3B,QAAaN,EAASM,OAG5B,OAFA3G,KAAK6H,YAAclB,EAAK,GAEjBA,EAAK,GAGd,uBACE3G,KAAKwH,cAAca,aAAanC,IAAI,QAAS,UAC7ClG,KAAKwH,cAAca,aAAanC,IAAI,QAAS,eAE7C,MAAMG,QAAiBC,MAAMtG,KAAKwH,cAAcc,YAGhD,aAFmBjC,EAASM,OAK9B,aACE,MAAMK,EAAMhH,KAAKqH,YAAYiB,WACvB/B,EAASvG,KAAKoF,UAAY,QAAU,MACpCmD,EAAWvI,KAAKwI,cAChBC,EAAYzI,KAAKoF,UAAY,kBAAoB,gBAEvD,IACE,MAAMiB,QAAiBC,MAAMU,EAAK,CAChCT,OAAQA,EACRC,QAAS,CACP,eAAgB,oBAElB3B,KAAM0D,IAEFG,QAAgBrC,EAASM,OAQ/B,OANA5F,SAAS4C,cACP,IAAIC,YAAY6E,EAAW,CACzBE,OAAQ,CAAED,cAIPA,EACP,MAAOvB,GACPC,QAAQD,MAAM,eAAgBA,IAIlCqB,cACE,MAAMI,EAAO5I,KAAK0F,YAAYS,YACxBoC,EAAW,IAAItC,SAAS2C,GACxB5C,EAAO,CACX6C,MAAON,EAASO,IAAI,SACpBC,YAAaR,EAASO,IAAI,eAC1BE,YAAaT,EAASO,IAAI,eAC1BG,MAAOC,SAASX,EAASO,IAAI,UAC7BK,SAAUD,SAASX,EAASO,IAAI,aAChCM,SAAUF,SAASX,EAASO,IAAI,aAChCO,OAAQH,SAASX,EAASO,IAAI,WAC9BlC,OAAQ5G,KAAKsJ,cAAcf,IAG7B,OADIvI,KAAK6H,aAAe7H,KAAK6H,YAAY0B,KAAIvD,EAAKuD,GAAKvJ,KAAK6H,YAAY0B,IACjEC,KAAKC,UAAUzD,GAGxBsD,cAAcf,GACZ,MAAMmB,EAAUnB,EAASoB,OAAO,UAC1BC,EAAOrB,EAASoB,OAAO,OAC7B,OAAOD,EAAQxH,IAAI,CAAC4E,EAAQ+C,KACnB,CACL7C,IAAK4C,EAAKC,GACV/C,YAKNmB,aACE,MACEY,EAAQ,GADV,YAEEE,EAAc,GAFhB,MAGEE,EAAQ,EAHV,SAIEE,EAAW,EAJb,SAKEC,EAAW,EALb,OAMEC,EAAS,GANX,YAOEL,EAAc,IACZ,GACJpB,GAEA,MAAQ,+RAM8BkC,EAC1BjB,mZAM6IiB,EAC/If,mhBAUA/I,KAAK+J,4BAA4BnC,EAAYoB,iOAKjBC,0OAIAE,8RAKFC,sTAKhBC,EAAS,WAAa,wDACrBA,EAAsB,GAAb,qTAahCU,4BAA4BnC,EAAa,GAAIoC,EAAqB,IAchE,MAAQ,uGAZUpC,EAAW1F,IAAI+H,GACPA,EAASC,cAAchI,IAAI8G,IAC/C,MAAMH,EAAQiB,EAAY,GAAEG,EAASpB,WAAWG,EAAYH,SACtDsB,EAAanB,EAAYO,KAAOS,EACtC,MAAQ,kBAAiBhB,EAAYO,OACnCY,EAAa,WAAa,MACxBtB,eAEeuB,KAAK,KAEbA,KAAK,6BASxBhC,cAAcxB,EAAS,IACrB,MAAMuB,EAAavB,EAAO1E,IAAIwE,GACpB,mHAEqCoD,EAAWpD,EAAMM,+DACd8C,EAAWpD,EAAMI,iKAGdgD,EAC3CpD,EAAMI,iBACGgD,EAAWpD,EAAMM,6BACpB8C,EAAWpD,EAAMI,kMAQjC,OAAO9G,KAAKqK,mBAAmBlC,GAGjCkC,mBAAmB7K,GAEjB,OADqB,IAAIF,IAAa,CAAEE,UACpBgC,QAGtB0G,eAAeoC,GACb,MAAM5E,EAAc,GAIpB,MAHA,IAAI4E,EAAKC,iBAAiB,mBAAmBC,QAAQC,IACnD/E,EAAY+E,EAAGC,QAAQlJ,SAAWiJ,IAE7B/E,EAGT7D,oBACE7B,KAAK0F,YAAYS,YAAY1D,iBAAiB,SAAUzC,KAAK2K,UAC7D3K,KAAK0F,YAAYkF,eAAenI,iBAAiB,YAAazC,KAAK6K,UAGrElI,uBACE3C,KAAK0F,YAAYS,YAAYvD,oBAAoB,SAAU5C,KAAK2K,UAChE3K,KAAK0F,YAAYkF,eAAehI,oBAAoB,YAAa5C,KAAK6K,UAGxE3K,SACMF,KAAKwB,SAASxB,KAAKwB,QAAQtB,SAC/BF,KAAKwB,QAAU,KAGjB2C,UACEnE,KAAKE,SACLF,KAAK2C,uBAGPH,OAAOuB,GACL,MAAMC,EAAajD,SAASgB,cAAc,OAE1C,OADAiC,EAAWC,UAAYF,EAChBC,EAAWE,mB,oICvTtB,MAAM4G,E,KAASC,EAAOC,WAEP,MAAMC,EAAK,6DAEZjL,KAAKkL,gBAFO,yBAIN,KAChBlL,KAAKmL,SAAS,oBALQ,uBAQP1L,IACfO,KAAKmL,SAAS,gBACdL,EAAOM,SAAU,aAAY3L,EAAMkJ,OAAOD,QAAQa,MAGpD2B,eACE,MAAMG,EAAYC,OAAOC,SAASC,KAAKC,MAAM,KAC7C,MAA2C,QAApCJ,EAAUA,EAAUK,OAAS,GAAeL,EAAUA,EAAUK,OAAS,GAAK,KAGvF,eAME,aALM1L,KAAK2L,iBACX3L,KAAKwB,QAAUxB,KAAKwC,OAAOxC,KAAKiI,eAChCjI,KAAK4L,mBACL5L,KAAK0F,YAAc1F,KAAKkI,eAAelI,KAAKwB,SAC5CxB,KAAK6B,oBACE7B,KAAKwB,QAGdyG,cACE,MAAQ,6SAYV,uBACE,MAAM9B,EAAc,IAAIhB,EAAYnF,KAAKoF,iBACnCe,EAAYvE,SAElB5B,KAAK6L,WAAa,CAChB1F,eAIJyF,mBACE,IAAK,MAAME,KAAaC,OAAOC,QAAQhM,KAAK6L,YAC1C7L,KAAKwB,QAAQyK,cAAe,SAAQH,EAAU,OAAO9D,YAAY8D,EAAU,GAAGtK,SAIlF0G,eAAeoC,GACb,MAAM5E,EAAc,GAIpB,MAHA,IAAI4E,EAAKC,iBAAiB,mBAAmBC,QAAQC,IACnD/E,EAAY+E,EAAGC,QAAQlJ,SAAWiJ,IAE7B/E,EAGTyF,SAAS9G,EAAU,GAAIE,EAAO,UAAW2H,EAAU,KAC5B,IAAI9H,IAAoBC,EAAS,CACpDC,SAAU4H,EACV3H,SAEWK,OAGf/C,oBACEd,SAAS0B,iBAAiB,kBAAmBzC,KAAKmM,iBAClDpL,SAAS0B,iBAAiB,gBAAiBzC,KAAKoM,eAGlDzJ,uBACE5B,SAAS6B,oBAAoB,kBAAmB5C,KAAKmM,iBACrDpL,SAAS6B,oBAAoB,gBAAiB5C,KAAKoM,eAGrDlM,SACMF,KAAKwB,SAASxB,KAAKwB,QAAQtB,SAC/BF,KAAKwB,QAAU,KAGjB2C,UACEnE,KAAKE,SACLF,KAAK2C,uBACL,IAAK,MAAMmJ,KAAaC,OAAOM,OAAOrM,KAAK6L,YACzCC,EAAU3H,UAId3B,OAAOuB,GACL,MAAMC,EAAajD,SAASgB,cAAc,OAE1C,OADAiC,EAAWC,UAAYF,EAChBC,EAAWE","file":"products-edit-index-js-4.js","sourcesContent":["export default class SortableList {\n  onPointerDown = (event) => {\n    const item = event.target.closest('.sortable-list__item');\n    if (!item) return;\n    event.preventDefault();\n    const handleGrab = event.target.closest('[data-grab-handle]');\n    const handleDelete = event.target.closest('[data-delete-handle]');\n\n    if (handleGrab) {\n      this.dragstart(item, event);\n    } else if (handleDelete) {\n      item.remove();\n    }\n  }\n\n  onPointerUp = (event) => {\n    event.preventDefault();\n    this.dragend();\n  }\n\n  onPointerMove = (event) => {\n    event.preventDefault();\n    this.setStyles(this.dragged, {\n      left: `${event.x - this.shiftX}px`,\n      top: `${event.y - this.shiftY}px`,\n    });\n\n    this.dragged.style.visibility = 'hidden';\n    const elementBellow = document.elementFromPoint(event.x, event.y);\n    this.dragged.style.visibility = '';\n\n    // Если курсор вышел за пределы окна, то бросаем перетаскиваемый элемент\n    if (!elementBellow) {\n      this.dragend();\n      return;\n    }\n\n    // Элемент над которым находится курсор в данный момент перетаскивания\n    const droppable = elementBellow.closest('.sortable-list__item');\n\n    // Если в этот элемент нельзя сбросить, то завершаем функцию\n    if (!droppable || droppable === this.currentDroppable) {\n      this.currentDroppable = null;\n      return;\n    }\n\n    const coordY = droppable.getBoundingClientRect().top;\n\n    // Узнаем направление движения курсора\n    const moveDirection = this.getMoveDirection(this.pageY, event.pageY);\n    this.pageY = event.pageY;\n\n    // Если курсор зашел на элемент доступный для сбрасывания на него, то перемещаем плейсхолдер на его место\n    if (event.pageY > coordY) {\n      const element = (moveDirection === 'down') ? droppable.nextSibling : droppable;\n      this.insertPlaceholder(element);\n    }\n\n    this.currentDroppable = droppable;\n  }\n\n  constructor({items} = {}) {\n    this.elements = items;\n    this.render();\n    this.addEventListeners();\n  }\n\n  render() {\n    const list = document.createElement('ul');\n    list.classList.add('sortable-list');\n    const elements = this.elements.map((element) => this.getListItem(element));\n    list.append(...elements);\n    this.placeholder = this.getPlaceholder();\n    this.element = list;\n  }\n\n  getListItem(elem) {\n    const element = typeof elem === 'object' ? elem : this.toHTML(elem); // Добавил поддержку строк, а не только DOM элеиментов\n    element.classList.add('sortable-list__item');\n    return element;\n  }\n\n  getPlaceholder() {\n    const placeholder = document.createElement('div');\n    placeholder.classList.add('sortable-list__placeholder');\n    return placeholder;\n  }\n\n  addEventListeners() {\n    this.element.addEventListener('pointerdown', this.onPointerDown);\n  }\n\n  removeEventListeners() {\n    this.element.removeEventListener('pointerdown', this.onPointerDown);\n  }\n\n  setStyles(element, props) {\n    for (const prop in props) {\n      element.style[prop] = props[prop];\n    }\n  }\n\n  dragstart(dragged, event) {\n    this.dragged = dragged;\n    this.element.addEventListener('pointerup', this.onPointerUp);\n\n    const draggedRect = this.dragged.getBoundingClientRect();\n    this.shiftX = event.clientX - draggedRect.left;\n    this.shiftY = event.clientY - draggedRect.top;\n\n    this.draggedHeight = this.dragged.clientHeight;\n    this.draggedWidth = this.dragged.clientWidth;\n\n    this.setStyles(this.dragged, {\n      width: `${this.draggedWidth}px`,\n      left: `${event.x - this.shiftX}px`,\n      top: `${event.y - this.shiftY}px`,\n    });\n    this.setStyles(this.placeholder, {\n      height: `${this.draggedHeight}px`\n    });\n\n    this.insertPlaceholder(this.dragged);\n    this.dragged.classList.add('sortable-list__item_dragging');\n\n    this.element.addEventListener('pointermove', this.onPointerMove);\n  }\n\n  dragend() {\n    this.element.insertBefore(this.dragged, this.placeholder);\n    this.placeholder.remove();\n    this.setStyles(this.dragged, {\n      width: '',\n      left: '',\n      top: '',\n    });\n\n    this.dragged.classList.remove('sortable-list__item_dragging');\n    this.dragged = null;\n\n    this.element.removeEventListener('pointermove', this.onPointerMove);\n    this.element.removeEventListener('pointerup', this.onPointerUp);\n    this.element.dispatchEvent(new CustomEvent('dragend'));\n  }\n\n  getMoveDirection(oldY, newY) {\n    if (oldY < newY) {\n      return 'down';\n    } else if (oldY > newY) {\n      return 'up';\n    }\n  }\n\n  insertPlaceholder(element) {\n    this.element.insertBefore(this.placeholder, element);\n  }\n\n  toHTML(htmlString) {\n    const htmlObject = document.createElement('div');\n    htmlObject.innerHTML = htmlString;\n    return htmlObject.firstElementChild;\n  }\n\n  remove() {\n    if (this.element) this.element.remove();\n    this.element = null;\n    this.removeEventListeners();\n  }\n\n  destroy() {\n    this.remove();\n  }\n}\n","export default class NotificationMessage {\n  constructor(message = '', {duration = 1000, type = 'success'} = {}) {\n    this.message = message;\n    this.duration = duration;\n    this.type = type;\n\n    this.render();\n  }\n\n  get template() {\n    return `\n      <div class=\"notification notification_${this.type} show\">\n        <div class=\"notification__content\"> ${this.message}</div>\n      </div>\n    `;\n  }\n\n  setTimer() {\n    setTimeout(() => {\n      this.destroy();\n    }, this.duration);\n  }\n\n  render() {\n    const wrapper = document.createElement('div');\n    wrapper.innerHTML = this.template;\n    this.element = wrapper.firstElementChild;\n  }\n\n  show(target = document.body) {\n    if (NotificationMessage.currentNotification) NotificationMessage.currentNotification.destroy();\n    target.append(this.element);\n    clearTimeout(NotificationMessage.timer);\n    NotificationMessage.timer = this.setTimer();\n    NotificationMessage.currentNotification = this;\n  }\n\n  remove() {\n    if (this.element) this.element.remove();\n    this.element = null;\n  }\n\n  destroy() {\n    this.remove();\n    NotificationMessage.currentNotification = null;\n  }\n}\n","export default string => string\n  .replace(/&/g, '&amp;')\n  .replace(/\"/g, '&quot;')\n  .replace(/'/g, '&#39;')\n  .replace(/</g, '&lt;')\n  .replace(/>/g, '&gt;');\n","import SortableList from '~components/sortable-list/index.js';\nimport escapeHtml from '~utils/escape-html.js';\n\nexport default class ProductForm {\n  onSubmit = event => {\n    event.preventDefault();\n    this.save();\n  };\n\n  addImage = event => {\n    event.preventDefault();\n\n    const imageInput = document.createElement('input');\n    imageInput.type = 'file';\n    imageInput.accept = 'image/*';\n    imageInput.hidden = true;\n    imageInput.addEventListener('change', this.uploadImage);\n\n    this.subElements.imageListContainer.append(imageInput);\n    imageInput.click();\n  };\n\n  uploadImage = async event => {\n    const input = event.target;\n    const file = input.files[0];\n    const data = new FormData();\n    data.set('image', file);\n\n    this.subElements.productForm.uploadImage.classList.add('is-loading');\n    this.subElements.productForm.uploadImage.disabled = true;\n\n    try {\n      const response = await fetch('https://api.imgur.com/3/image', {\n        method: 'POST',\n        headers: {\n          Authorization: `Client-ID ${process.env.IMGUR_CLIENT_ID}`\n        },\n        body: data\n      });\n      const image = await response.json();\n      this.images.push({\n        source: image.data.name,\n        url: image.data.link\n      });\n      this.renderImagesList();\n    } catch (error) {\n      console.error(error);\n    } finally {\n      this.subElements.productForm.uploadImage.classList.remove('is-loading');\n      this.subElements.productForm.uploadImage.disabled = false;\n    }\n  };\n\n  constructor(productId) {\n    this.productId = productId;\n    this.images = [];\n    this.productsUrl = new URL('api/rest/products  ', process.env.BACKEND_URL);\n    this.categoriesUrl = new URL('api/rest/categories  ', process.env.BACKEND_URL);\n  }\n\n  async render() {\n    const requests = [this.loadCategories()];\n    if (this.productId) requests.push(this.loadProductData());\n\n    const [categories, productData = {}] = await Promise.all(requests);\n\n    if (productData.images) this.images = productData.images;\n\n    if (this.element)\n      this.element.replaceWith(this.toHTML(this.getTemplate(productData, categories)));\n    else this.element = this.toHTML(this.getTemplate(productData, categories));\n\n    this.subElements = this.getSubElements(this.element);\n\n    this.renderImagesList();\n    this.addEventListeners();\n\n    return this.element;\n  }\n\n  renderImagesList() {\n    const imagesList = this.getImagesList(this.images);\n    if (this.imagesList) {\n      this.imagesList.replaceWith(imagesList);\n    } else {\n      this.subElements.imageListContainer.append(imagesList);\n    }\n    this.imagesList = imagesList;\n  }\n\n  async loadProductData() {\n    this.productsUrl.searchParams.set('id', this.productId);\n\n    const response = await fetch(this.productsUrl.toString());\n    const json = await response.json();\n    this.productData = json[0];\n\n    return json[0];\n  }\n\n  async loadCategories() {\n    this.categoriesUrl.searchParams.set('_sort', 'weight');\n    this.categoriesUrl.searchParams.set('_refs', 'subcategory');\n\n    const response = await fetch(this.categoriesUrl.toString());\n    const json = await response.json();\n\n    return json;\n  }\n\n  async save() {\n    const url = this.productsUrl.toString();\n    const method = this.productId ? 'PATCH' : 'PUT';\n    const formData = this.getFormData();\n    const eventName = this.productId ? 'product-updated' : 'product-saved';\n\n    try {\n      const response = await fetch(url, {\n        method: method,\n        headers: {\n          'Content-Type': 'application/json'\n        },\n        body: formData\n      });\n      const product = await response.json();\n\n      document.dispatchEvent(\n        new CustomEvent(eventName, {\n          detail: { product }\n        })\n      );\n\n      return product;\n    } catch (error) {\n      console.error('Save product', error);\n    }\n  }\n\n  getFormData() {\n    const form = this.subElements.productForm;\n    const formData = new FormData(form);\n    const data = {\n      title: formData.get('title'),\n      description: formData.get('description'),\n      subcategory: formData.get('subcategory'),\n      price: parseInt(formData.get('price')),\n      discount: parseInt(formData.get('discount')),\n      quantity: parseInt(formData.get('quantity')),\n      status: parseInt(formData.get('status')),\n      images: this.getImagesData(formData)\n    };\n    if (this.productData && this.productData.id) data.id = this.productData.id;\n    return JSON.stringify(data);\n  }\n\n  getImagesData(formData) {\n    const sources = formData.getAll('source');\n    const urls = formData.getAll('url');\n    return sources.map((source, index) => {\n      return {\n        url: urls[index],\n        source\n      };\n    });\n  }\n\n  getTemplate(\n    {\n      title = '',\n      description = '',\n      price = 0,\n      discount = 0,\n      quantity = 0,\n      status = '',\n      subcategory = ''\n    } = {},\n    categories\n  ) {\n    return `\n      <div class=\"product-form\">\n        <form data-element=\"productForm\" class=\"form-grid\">\n          <div class=\"form-group form-group__half_left\">\n            <fieldset>\n              <label class=\"form-label\">Название товара</label>\n              <input required=\"\" value=\"${escapeHtml(\n                title\n              )}\" id=\"title\" type=\"text\" name=\"title\" class=\"form-control\" placeholder=\"Название товара\">\n            </fieldset>\n          </div>\n          <div class=\"form-group form-group__wide\">\n            <label class=\"form-label\">Описание</label>\n            <textarea required=\"\" class=\"form-control\" id=\"description\" name=\"description\" data-element=\"productDescription\" placeholder=\"Описание товара\">${escapeHtml(\n              description\n            )}</textarea>\n          </div>\n          <div class=\"form-group form-group__wide\" data-element=\"sortable-list-container\">\n            <label class=\"form-label\">Фото</label>\n            <div data-element=\"imageListContainer\"></div>\n            <button data-element=\"imageUploadBtn\" type=\"button\" name=\"uploadImage\" class=\"button-primary-outline\"><span>Загрузить</span></button>\n          </div>\n          <div class=\"form-group form-group__half_left\">\n            <label class=\"form-label\">Категория</label>\n            ${this.getCategoriesSelectTemplate(categories, subcategory)}\n          </div>\n          <div class=\"form-group form-group__half_left form-group__two-col\">\n            <fieldset>\n              <label class=\"form-label\">Цена ($)</label>\n              <input required=\"\" value=\"${price}\" id=\"price\" type=\"number\" name=\"price\" class=\"form-control\" placeholder=\"100\">\n            </fieldset>\n            <fieldset>\n              <label class=\"form-label\">Скидка ($)</label>\n              <input required=\"\" value=\"${discount}\" id=\"discount\" type=\"number\" name=\"discount\" class=\"form-control\" placeholder=\"0\">\n            </fieldset>\n          </div>\n          <div class=\"form-group form-group__part-half\">\n            <label class=\"form-label\">Количество</label>\n            <input required=\"\" value=\"${quantity}\" id=\"quantity\" type=\"number\" class=\"form-control\" name=\"quantity\" placeholder=\"1\">\n          </div>\n          <div class=\"form-group form-group__part-half\">\n            <label class=\"form-label\">Статус</label>\n            <select class=\"form-control\" id=\"status\" name=\"status\">\n              <option ${status ? 'selected' : ''} value=\"1\">Активен</option>\n              <option ${!status ? 'selected' : ''} value=\"0\">Неактивен</option>\n            </select>\n          </div>\n          <div class=\"form-buttons\">\n            <button type=\"submit\" name=\"save\" class=\"button-primary-outline\">\n              Сохранить товар\n            </button>\n          </div>\n        </form>\n      </div>\n    `;\n  }\n\n  getCategoriesSelectTemplate(categories = [], currentSubcategory = '') {\n    const createOptions = () => {\n      const options = categories.map(category => {\n        const subcategories = category.subcategories.map(subcategory => {\n          const title = escapeHtml(`${category.title} > ${subcategory.title}`);\n          const isSelected = subcategory.id === currentSubcategory;\n          return `<option value=\"${subcategory.id}\" ${\n            isSelected ? 'selected' : ''\n          }>${title}</option>`;\n        });\n        return subcategories.join('');\n      });\n      return options.join('');\n    };\n    return `\n      <select class=\"form-control\" id=\"subcategory\" name=\"subcategory\" id=\"subcategory\">\n        ${createOptions()}\n      </select>\n    `;\n  }\n\n  getImagesList(images = []) {\n    const imagesList = images.map(image => {\n      return `\n        <li class=\"products-edit__imagelist-item\" style=\"\">\n          <input type=\"hidden\" name=\"url\" value=\"${escapeHtml(image.url)}\">\n          <input type=\"hidden\" name=\"source\" value=\"${escapeHtml(image.source)}\">\n          <span>\n            <img src=\"/icons/icon-grab.svg\" data-grab-handle alt=\"grab\">\n            <img class=\"sortable-table__cell-img\" alt=\"${escapeHtml(\n              image.source\n            )}\" src=\"${escapeHtml(image.url)}\">\n            <span>${escapeHtml(image.source)}</span>\n          </span>\n          <button type=\"button\">\n            <img src=\"/icons/icon-trash.svg\" data-delete-handle alt=\"delete\">\n          </button>\n        </li>\n      `;\n    });\n    return this.createSortableList(imagesList);\n  }\n\n  createSortableList(items) {\n    const sortableList = new SortableList({ items });\n    return sortableList.element;\n  }\n\n  getSubElements(root) {\n    const subElements = {};\n    [...root.querySelectorAll('[data-element]')].forEach(el => {\n      subElements[el.dataset.element] = el;\n    });\n    return subElements;\n  }\n\n  addEventListeners() {\n    this.subElements.productForm.addEventListener('submit', this.onSubmit);\n    this.subElements.imageUploadBtn.addEventListener('pointerup', this.addImage);\n  }\n\n  removeEventListeners() {\n    this.subElements.productForm.removeEventListener('submit', this.onSubmit);\n    this.subElements.imageUploadBtn.removeEventListener('pointerup', this.addImage);\n  }\n\n  remove() {\n    if (this.element) this.element.remove();\n    this.element = null;\n  }\n\n  destroy() {\n    this.remove();\n    this.removeEventListeners();\n  }\n\n  toHTML(htmlString) {\n    const htmlObject = document.createElement('div');\n    htmlObject.innerHTML = htmlString;\n    return htmlObject.firstElementChild;\n  }\n}\n","import ProductForm from '~components/product-form/index.js';\nimport NotificationMessage from '~components/notification/index.js';\nimport Router from '~/router/index.js';\nconst router = Router.instance();\n\nexport default class Page {\n  conponents;\n  productId = this.getProductId();\n\n  onProductUpdate = () => {\n    this.notyShow('Товар сохранен');\n  };\n\n  onProductSave = (event) => {\n    this.notyShow('Товар создан');\n    router.navigate(`/products/${event.detail.product.id}`);\n  };\n\n  getProductId() {\n    const herfArray = window.location.href.split('/');\n    return herfArray[herfArray.length - 1] !== 'add' ? herfArray[herfArray.length - 1] : null;\n  }\n\n  async render() {\n    await this.initComponents();\n    this.element = this.toHTML(this.getTemplate());\n    this.renderComponents();\n    this.subElements = this.getSubElements(this.element);\n    this.addEventListeners();\n    return this.element;\n  }\n\n  getTemplate() {\n    return `\n      <div class=\"products-edit\">\n        <div class=\"content__top-panel\">\n          <h1 class=\"page-title\"><a href=\"/products\" class=\"link\">Товары</a> / Добавить</h1>\n        </div>\n        <div class=\"content-box\">\n          <div data-productForm></div>\n        </div>\n      </div>\n    `;\n  }\n\n  async initComponents() {\n    const productForm = new ProductForm(this.productId);\n    await productForm.render();\n\n    this.components = {\n      productForm\n    };\n  }\n\n  renderComponents() {\n    for (const component of Object.entries(this.components)) {\n      this.element.querySelector(`[data-${component[0]}]`).replaceWith(component[1].element);\n    }\n  }\n\n  getSubElements(root) {\n    const subElements = {};\n    [...root.querySelectorAll('[data-element]')].forEach(el => {\n      subElements[el.dataset.element] = el;\n    });\n    return subElements;\n  }\n\n  notyShow(message = '', type = 'success', timeout = 2000) {\n    const notification = new NotificationMessage(message, {\n      duration: timeout,\n      type\n    });\n    notification.show();\n  }\n\n  addEventListeners() {\n    document.addEventListener('product-updated', this.onProductUpdate);\n    document.addEventListener('product-saved', this.onProductSave);\n  }\n\n  removeEventListeners() {\n    document.removeEventListener('product-updated', this.onProductUpdate);\n    document.removeEventListener('product-saved', this.onProductSave);\n  }\n\n  remove() {\n    if (this.element) this.element.remove();\n    this.element = null;\n  }\n\n  destroy() {\n    this.remove();\n    this.removeEventListeners();\n    for (const component of Object.values(this.components)) {\n      component.destroy();\n    }\n  }\n\n  toHTML(htmlString) {\n    const htmlObject = document.createElement('div');\n    htmlObject.innerHTML = htmlString;\n    return htmlObject.firstElementChild;\n  }\n}\n"],"sourceRoot":""}